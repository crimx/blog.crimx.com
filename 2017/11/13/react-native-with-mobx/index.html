<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="zh-CN"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="zh-CN"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="zh-CN"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="zh-CN">
<!--<![endif]-->

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0">
<title>React Native 搭配 MobX 使用心得 | CRIMX</title>
<link rel="apple-touch-icon" sizes="57x57" href="/images/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192" href="/images/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<link rel="alternate" href="atom.xml" title="CRIMX" type="application/atom+xml">
<meta name="description" content="MobX 是一款十分优秀的状态管理库，不但书写简洁还非常高效。当然这是我在使用之后才体会到的，当初试水上车的主要原因是响应式，考虑到可能会更符合 Vue 过来的思考方式。然而其实两者除了响应式以外并没有什么相似之处:joy:。 在使用过程中走了不少弯路，一部分是因为当时扫两眼文档就动手，对 MobX 机制理解得不够；其它原因是 MobX 终究只是一个库，会受限于 React 机制，以及与其它非 M">
<meta name="keywords" content="JavaScript,React,React Native,MobX">
<meta property="og:type" content="article">
<meta property="og:title" content="React Native 搭配 MobX 使用心得">
<meta property="og:url" content="https://blog.crimx.com/2017/11/13/react-native-with-mobx/index.html">
<meta property="og:site_name" content="CRIMX">
<meta property="og:description" content="MobX 是一款十分优秀的状态管理库，不但书写简洁还非常高效。当然这是我在使用之后才体会到的，当初试水上车的主要原因是响应式，考虑到可能会更符合 Vue 过来的思考方式。然而其实两者除了响应式以外并没有什么相似之处:joy:。 在使用过程中走了不少弯路，一部分是因为当时扫两眼文档就动手，对 MobX 机制理解得不够；其它原因是 MobX 终究只是一个库，会受限于 React 机制，以及与其它非 M">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2017-11-13T12:18:33.761Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React Native 搭配 MobX 使用心得">
<meta name="twitter:description" content="MobX 是一款十分优秀的状态管理库，不但书写简洁还非常高效。当然这是我在使用之后才体会到的，当初试水上车的主要原因是响应式，考虑到可能会更符合 Vue 过来的思考方式。然而其实两者除了响应式以外并没有什么相似之处:joy:。 在使用过程中走了不少弯路，一部分是因为当时扫两眼文档就动手，对 MobX 机制理解得不够；其它原因是 MobX 终究只是一个库，会受限于 React 机制，以及与其它非 M">
<meta name="twitter:creator" content="@straybugs">
<link rel="stylesheet" href="/static/style.css">
<!-- <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script> -->
<script>
;
(function() {
    var h = document.getElementsByTagName('html')[0]
    h.className = (' ' + h.className + ' ').replace(' no-js ', ' ').slice(1, -1)
}())
</script>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
<!--[if lt IE 9]>
    <p class="browser-warning" style="position:fixed;z-index:999999;top:0;left:0;right:0;padding:10px;text-align:center;color:red;background:yellow;">Why are you still using old version of IE??? Go and <a href="http://browsehappy.com/">upgrade your browser</a>.</p>
    <style>
      .site-menu-inner-wrapper{top:0;}
      .site-container{padding-top:45px;}
      .site-tags{font-size:14px;}
    </style>
  <![endif]-->
<div class="site-container">
<div class="site-menu js-progressive-bg-container" style="background: url('/images/post/cover/fantasy-2861107_1920-portrait.jpg') 28.72% 55.97%/cover">
<div class="site-menu-bg-thumb js-progressive-bg-thumbnail" style="background: url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAAeABEDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAUDBgcCBP/EACUQAAAGAQMEAwEAAAAAAAAAAAABAgMEEQUGEiETFTFTIkFSkf/EABcBAQEBAQAAAAAAAAAAAAAAAAMCBAX/xAAdEQADAAICAwAAAAAAAAAAAAAAAQIDERITFCFR/9oADAMBAAIRAxEAPwClRpmnExqPf1LqhO7phqdj1zISiURfRHyFbeisg5EVJQ0o0J8mRDvAqm4/IEgnVJRdKI/A5rlLbijatv1SPH2KV+FAGmbU+xr+AA+Qy+lDhjUEJjEORSSRbi5Gd53pMtLfjKpe6xVjz80io13YjXKkyEfJzgw84FL2G8jYz73P9oAn2O+wAThHwnlR/9k=') 28.72% 55.97%/cover"></div>
<div class="site-menu-inner-wrapper">
<div class="menu-logo"><a class="icon-logo" href="/"></a></div>
<ul class="menu-social-icons">
<li><a class="icon-weibo" href="//www.weibo.com/bananajaward" target="_blank"></a></li>
<li><a class="icon-github" href="//github.com/crimx" target="_blank"></a></li>
<li><a class="icon-mail" href="mailto:%73%74%72%61%79%62%75%67%73%40%67%6D%61%69%6C%2E%63%6F%6D" target="_blank"></a></li>
<li><a class="icon-rss" href="/atom.xml"></a></li>
</ul>
<ul class="menu-navs">
<li><a href="/categories/">Categories</a></li>
<li><a href="/archives/">Archives</a></li>
<li><a href="/tags/">Tags</a></li>
<li><a href="/search/">Search</a></li>
<li><a href="/about/">About</a></li>
</ul>
</div>
</div>
<div class="site-menu-mask"></div>
<div class="main-content">
<header class="site-cover js-progressive-bg-container" style="background: url('/images/post/cover/fantasy-2861107_1920-portrait.jpg') 28.72% 55.97%/cover">
<div class="site-cover-bg-thumb js-progressive-bg-thumbnail" style="background: url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAAeABEDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAUDBgcCBP/EACUQAAAGAQMEAwEAAAAAAAAAAAABAgMEEQUGEiETFTFTIkFSkf/EABcBAQEBAQAAAAAAAAAAAAAAAAMCBAX/xAAdEQADAAICAwAAAAAAAAAAAAAAAQIDERITFCFR/9oADAMBAAIRAxEAPwClRpmnExqPf1LqhO7phqdj1zISiURfRHyFbeisg5EVJQ0o0J8mRDvAqm4/IEgnVJRdKI/A5rlLbijatv1SPH2KV+FAGmbU+xr+AA+Qy+lDhjUEJjEORSSRbi5Gd53pMtLfjKpe6xVjz80io13YjXKkyEfJzgw84FL2G8jYz73P9oAn2O+wAThHwnlR/9k=') 28.72% 55.97%/cover"></div><a class="cover-logo" href="/"></a>
<div class="title-wrapper">
<h1 class="site-title" itemprop="name">React Native 搭配 MobX 使用心得</h1>
<div class="article-meta">
<div class="article-category"><a class="article-category-link" href="/categories/JavaScript/">JavaScript</a></div><a href="/2017/11/13/react-native-with-mobx/" class="article-date"><time datetime="2017-11-12T16:00:00.000Z" itemprop="datePublished">2017-11-13</time></a> <a rel="license" class="cc-license-wrapper" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank" title="This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License."><svg class="cc-license" fill="#fff"><use xlink:href="/images/symbol-defs.svg#icon-cc-license"/></svg></a></div>
</div>
</header>
<div class="tagline-wrap">
<section class="tagline"><svg class="tagline-icon-quote" fill="#bdc3c7"><use xlink:href="/images/symbol-defs.svg#icon-quote"/></svg>
<blockquote class="tagline-content">"The mob is the mother of tyrants."</blockquote>
<footer class="tagline-cite"><cite>Diogenes</cite></footer>
</section>
</div>
<div class="toc-mousearea"></div>
<div class="toc-wrapper">
<div class="toc-container">
<ol class="toc">
<li class="toc-item toc-level-2"><a class="toc-link" href="#与非响应式组件兼容问题"><span class="toc-text">与非响应式组件兼容问题</span></a>
<ol class="toc-child">
<li class="toc-item toc-level-3"><a class="toc-link" href="#observable-ref"><span class="toc-text">observable.ref</span></a></li>
<li class="toc-item toc-level-3"><a class="toc-link" href="#observable-shallowArray-与-observable-shallowMap"><span class="toc-text">observable.shallowArray() 与 observable.shallowMap()</span></a></li>
</ol>
</li>
<li class="toc-item toc-level-2"><a class="toc-link" href="#computed"><span class="toc-text">computed</span></a></li>
<li class="toc-item toc-level-2"><a class="toc-link" href="#observable-map"><span class="toc-text">observable.map</span></a></li>
<li class="toc-item toc-level-2"><a class="toc-link" href="#避免在父组件中访问子组件的属性"><span class="toc-text">避免在父组件中访问子组件的属性</span></a></li>
<li class="toc-item toc-level-2"><a class="toc-link" href="#小组件"><span class="toc-text">小组件</span></a></li>
</ol>
</div>
</div>
<article id="post-react-native-with-mobx" class="article--post" itemscope="" itemprop="blogPost">
<div class="article-inner js-no-wrap-menu">
<div class="article-entry postify" itemprop="articleBody">
<p>MobX 是一款十分优秀的状态管理库，不但书写简洁还非常高效。当然这是我在使用之后才体会到的，当初试水上车的主要原因是响应式，考虑到可能会更符合 Vue 过来的思考方式。然而其实两者除了响应式以外并没有什么相似之处:joy:。</p>
<p>在使用过程中走了不少弯路，一部分是因为当时扫两眼文档就动手，对 MobX 机制理解得不够；其它原因是 MobX 终究只是一个库，会受限于 React 机制，以及与其它非 MobX 管理组件的兼容问题。当中很多情况在文档已经给出了说明（<a href="https://mobx.js.org/best/react.html" target="_blank">这里</a>和<a href="https://mobx.js.org/best/react-performance.html" target="_blank">这里</a>），我根据自己遇到的再做一番总结。</p>
<h2 id="与非响应式组件兼容问题"><a href="#与非响应式组件兼容问题" class="headerlink" title="与非响应式组件兼容问题"></a>与非响应式组件兼容问题</h2>
<p>与非响应式的组件一起工作时，MobX 有时需要为它们提供一份非响应式的数据副本，以免 observable 被其它组件修改。</p>
<h3 id="observable-ref"><a href="#observable-ref" class="headerlink" title="observable.ref"></a>observable.ref</h3>
<p>使用 React Navigation 导航时，如果要交由 MobX 管理，则需要手动配置导航状态栈，此时用 <code>@observable.ref</code> “浅观察”可避免状态被 React Navigation 修改时触发 MobX 警告。</p>
<p>当 Navigator 接受 <code>navigation</code> props 时代表导航状态为手动管理。</p>
<p></p>
<figure class="highlight javascript">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre>
</td>
<td class="code">
<pre><span class="line"><span class="keyword">import</span> &#123; addNavigationHelpers, StackNavigator &#125; <span class="keyword">from</span> <span class="string">'react-navigation'</span></span><br><span class="line"><span class="keyword">import</span> &#123; observable, action &#125; <span class="keyword">from</span> <span class="string">'mobx'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider, observer &#125; <span class="keyword">from</span> <span class="string">'mobx-react'</span></span><br><span class="line"><span class="keyword">import</span> AppComp <span class="keyword">from</span> <span class="string">'./AppComp'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppNavigator = StackNavigator(&#123;</span><br><span class="line">  App: &#123; <span class="attr">screen</span>: AppComp &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  initialRouteName: <span class="string">'App'</span>,</span><br><span class="line">  headerMode: <span class="string">'none'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">AppNavigation</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  @observable.ref navigationState = &#123;</span><br><span class="line">    index: <span class="number">0</span>,</span><br><span class="line">    routes: [</span><br><span class="line">      &#123; <span class="attr">key</span>: <span class="string">'App'</span>, <span class="attr">routeName</span>: <span class="string">'App'</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @action.bound dispatchNavigation = <span class="function">(<span class="params">action, stackNavState = <span class="literal">true</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> previousNavState = stackNavState ? <span class="keyword">this</span>.navigationState : <span class="literal">null</span></span><br><span class="line">    <span class="keyword">this</span>.navigationState = <span class="keyword">this</span>.AppNavigator.router.getStateForAction(action, previousNavState)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.navigationState</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Provider</span><br><span class="line">        dispatchNavigation=&#123;<span class="keyword">this</span>.dispatchNavigation&#125;</span><br><span class="line">        navigationState=&#123;<span class="keyword">this</span>.navigationState&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;AppNavigator navigation=&#123;addNavigationHelpers(&#123;</span><br><span class="line">          dispatch: <span class="keyword">this</span>.dispatchNavigation,</span><br><span class="line">          state: <span class="keyword">this</span>.navigationState,</span><br><span class="line">        &#125;)&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre>
</td>
</tr>
</table>
</figure>
<p></p>
<h3 id="observable-shallowArray-与-observable-shallowMap"><a href="#observable-shallowArray-与-observable-shallowMap" class="headerlink" title="observable.shallowArray() 与 observable.shallowMap()"></a><code>observable.shallowArray()</code> 与 <code>observable.shallowMap()</code></h3>
<p>MobX 还提供其它方便的数据结构来存放非响应式数据。</p>
<p>比如使用 <code>SectionList</code> 的时候，我们要为其提供数据用于生成列表，由于 Native 官方的实现跟 MobX 不兼容，这个数据不能是响应式的，不然 MobX 会报一堆警告。</p>
<p>MobX 有个 <code>mobx.toJS()</code> 方法可以导出非响应式副本；如果结构不相同还可以使用 <code>@computed</code> 自动生成符合的数据。但这两个方法每次添加项目都要全部遍历一遍，可能会存在性能问题。</p>
<p>这时其实可以维护一个 <code>observable.shallowArray</code>，里面只放 <code>key</code> 数据，只用于生成列表（像骨架一样）。传给 <code>SectionList</code> 的 <code>sections</code> props 时 <code>slice</code> 数组复制副本（shallowArray 里的数据非响应式，所以只需浅复制，复杂度远小于上面两种方式）。</p>
<p>然后 store 维护一个 <code>observable.map</code> 来存放每个项的数据，在项（item）组件中 <code>inject</code> store 进去，再利用 <code>key</code> 从 map 中获取数据来填充。</p>
<p>通过 shallowArray 可以让 MobX 识别列表长度变化自动更新列表，利用 map 维护项数据可以使每个项保持响应式却互不影响，对长列表优化效果很明显。</p>
<p></p>
<figure class="highlight javascript">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
</td>
<td class="code">
<pre><span class="line"><span class="comment">// store comp</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStore</span> </span>&#123;</span><br><span class="line">  @observable sections = observable.shallowArray()</span><br><span class="line">  @observable itemData = observable.map()</span><br><span class="line"></span><br><span class="line">  @action.bound appendSection (section) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = []</span><br><span class="line">    section.items.forEach(action(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.itemData.set(item.id, item)</span><br><span class="line">      data.push(&#123;<span class="attr">key</span>: item.id&#125;)</span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="keyword">this</span>.sections.push(&#123;</span><br><span class="line">      key: section.id,</span><br><span class="line">      data</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
</td>
</tr>
</table>
</figure>
<p></p>
<p></p>
<figure class="highlight javascript">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
</td>
<td class="code">
<pre><span class="line"><span class="comment">// MyList comp</span></span><br><span class="line"><span class="keyword">import</span> &#123; SectionList &#125; <span class="keyword">from</span> <span class="string">'react-native'</span></span><br><span class="line">@inject(<span class="string">'myStore'</span>)</span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  _renderItem = <span class="function">(<span class="params">&#123;item&#125;</span>) =&gt;</span> &lt;SectionItem id=&#123;item.key&#125; /&gt;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;SectionList</span><br><span class="line">        getItemLayout=&#123;<span class="keyword">this</span>._getItemLayout&#125;</span><br><span class="line">        sections=&#123;<span class="keyword">this</span>.props.myStore.sections.slice()&#125;</span><br><span class="line">        renderSectionHeader=&#123;<span class="keyword">this</span>._renderSectionHeader&#125;</span><br><span class="line">        renderItem=&#123;<span class="keyword">this</span>._renderItem&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
</td>
</tr>
</table>
</figure>
<p></p>
<p></p>
<figure class="highlight javascript">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
</td>
<td class="code">
<pre><span class="line"><span class="comment">// SectionItem comp</span></span><br><span class="line">@inject(<span class="string">'myStore'</span>)</span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SectionItem</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;myStore, id&#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">const</span> itemData = myStore.itemData.get(id)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Text&gt;&#123;itemData.title&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre>
</td>
</tr>
</table>
</figure>
<p></p>
<h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2>
<p>利用 <code>@computed</code> 缓存数据可以做一些优化。</p>
<p>比如有一个响应式的数组 <code>arr</code>，一个组件要根据 <code>arr</code> 是否为空更新。如果直接访问 <code>arr.length</code>，那么只要数组长度发生变化，这个组件都要 render 一遍。</p>
<p>此时利用 computed 生成，组件只需要判断 <code>isArrEmpty</code> 就可以减少不必要的更新：</p>
<p></p>
<figure class="highlight javascript">
<table>
<tr>
<td class="gutter">
<pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
</td>
<td class="code">
<pre><span class="line">@computed get isArrEmpty () &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.arr.length &lt;= <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre>
</td>
</tr>
</table>
</figure>
<p></p>
<h2 id="observable-map"><a href="#observable-map" class="headerlink" title="observable.map"></a>observable.map</h2>
<p>因 JS 机制 MobX 不能检测属性的增删，所以最好用 <code>observable.map</code> 取代简单 <code>{}</code> 对象。另外 MobX 没有提供 Set 支持，可以用 key 和 value 一样的 Map 代替。</p>
<h2 id="避免在父组件中访问子组件的属性"><a href="#避免在父组件中访问子组件的属性" class="headerlink" title="避免在父组件中访问子组件的属性"></a>避免在父组件中访问子组件的属性</h2>
<p>这条规则在文档也提到，原因很简单，MobX 对于一个 <code>observer</code> 组件，是通过访问属性来记录依赖的。所以哪怕父组件里没有用到这个属性，只是为了作为 props 传给子组件，MobX 还是算它依赖了这个属性，于是会产生不必要的更新。最好的方式是将数据统一放在 store 中，子组件通过 <code>inject</code> store 方式获取数据。</p>
<h2 id="小组件"><a href="#小组件" class="headerlink" title="小组件"></a>小组件</h2>
<p>由于 React 的机制，MobX 只能在组件层面发光发热，对于组件内部就无能为力了。所以大组件用 MobX 很容易卡死（用其它也会:sweat_smile:），小组件才能真正发挥 MobX 自动管理更新的优势。</p>
<p>【完】</p>
</div>
</div>
<footer class="article-footer">
<ul class="article-tag-list">
<li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li>
<li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MobX/">MobX</a></li>
<li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li>
<li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React-Native/">React Native</a></li>
</ul>
<nav id="article-nav"><a href="/2017/12/02/how-to-get-the-sentence-of-a-selection/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">newer</strong><div class="article-nav-title">获取选择文本所在的句子</div></a><a href="/2017/09/20/new-dom-nodes-detection/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">older</strong><div class="article-nav-title">检测 DOM 结点插入</div></a></nav>
</footer>
</article>
<section id="comments">
<div id="disqus_thread" data-url="https://blog.crimx.com/2017/11/13/react-native-with-mobx/" data-identifier="2017/11/13/react-native-with-mobx/" data-src="//crimx.disqus.com/embed.js">
<div class="no-comments">您还在局域网。 ——来自隔墙相望的评论</div><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank">comments powered by Disqus.</a></noscript></div>
</section>
<div class="menu-icon"><i class="menu-icon__logo"></i></div>
<footer class="site-footer">
<ul class="recommended-post">
<li class="recommended-post__item">
<a class="recommended-post__link" href="#">
<div class="recommended-post__cover js-progressive-bg-container">
<div class="recommended-post__thumbnail js-progressive-bg-thumbnail"></div>
</div>
<h1 class="recommended-post__title"></h1>
</a>
</li>
<li class="recommended-post__item">
<a class="recommended-post__link" href="#">
<div class="recommended-post__cover js-progressive-bg-container">
<div class="recommended-post__thumbnail js-progressive-bg-thumbnail"></div>
</div>
<h1 class="recommended-post__title"></h1>
</a>
</li>
<li class="recommended-post__item">
<a class="recommended-post__link" href="#">
<div class="recommended-post__cover js-progressive-bg-container">
<div class="recommended-post__thumbnail js-progressive-bg-thumbnail"></div>
</div>
<h1 class="recommended-post__title"></h1>
</a>
</li>
<li class="recommended-post__item">
<a class="recommended-post__link" href="#">
<div class="recommended-post__cover js-progressive-bg-container">
<div class="recommended-post__thumbnail js-progressive-bg-thumbnail"></div>
</div>
<h1 class="recommended-post__title"></h1>
</a>
</li>
</ul>
<div class="site-description">I <a href="https://github.com/crimx/" target="_blank">code</a>, <a href="http://codepen.io/straybugs/" target="_blank">design</a>, <a href="https://twitter.com/straybugs/" target="_blank">tweet</a> &amp; <a href="https://blog.crimx.com" target="_blank">blog</a>.</div>
<div class="copyright">© COPYRIGHT 2016 · Designed &amp; Wrote With <svg class="icon-heart"><use xlink:href="/images/symbol-defs.svg#icon-heart"/></svg></div>
</footer>
</div>
</div>
<script src="/static/bundle.js"></script>
<!-- Google Analytics -->
<script type="text/javascript">
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

ga('create', 'UA-49163616-3', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics --><noscript><style>.noscript-warning {
      position: fixed;
      z-index: 999999;
      top: 0;
      left: 0;
      right: 0;
      margin: auto;
      padding: 10px;
      font-size: 1.2em;
      color: #fff;
      background: orange;
      text-align: center;
    }</style><div class="noscript-warning">This site works best with JavaScript enabled</div></noscript></body>

</html>